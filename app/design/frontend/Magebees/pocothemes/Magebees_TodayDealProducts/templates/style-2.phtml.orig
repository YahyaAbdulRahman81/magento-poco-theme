<?php
/**
 * Template for displaying today deal products*
 * @var $block \Magebees\TodayDealProducts\Block\DealProducts
 */
use Magento\Framework\App\Action\Action;
$exist = ($block->getProductCollection() && $block->getProductCollection()->getSize() && (bool)$block->getConfigValues('enabled'));

if ((bool)$block->getConfigValues('enabled')) {
    $type = 'widget-new-grid';
    $mode = 'grid';
    $imageDisplayArea = 'new_products_content_widget_grid';
    $title = __($block->getDealData('title'));
    $deal_description = __($block->getDealData('description'));
    $items = $block->getProductCollection()->getItems();
	$productsCount = count($block->getProductCollection()->getData());
	
    $showWishlist = (bool)$block->getWishlist();
    $showCompare = (bool)$block->getCompare();
    $showCart = (bool)$block->getCart();
    //$templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::FULL_VIEW;
    $templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::DEFAULT_VIEW;
    $showPrice = (bool)$block->getPrice();
    $timer = $block->getCountTimer();
	$_helper = $this->helper('Magento\Catalog\Helper\Output');
    $unique_slider_key = $block->getUniqueSliderKey();
	
	$viewMode = 'grid';
	$showDescription = false;
	$pos = $block->getPositioned();
	$position = '';
	if ($pos != null) {
		$position = ' style="left:'.$block->getVar("{$image}:width").'px;'.' top:'.$block->getVar("{$image}:height").'px;"';
	}
	
	/* POCO THEME CUSTOMIZATION ADD CODE Start */ 
	include ($block->getTemplateFile('Magento_Catalog::product/product-list-theme-options.phtml'));
	/* POCO THEME CUSTOMIZATION ADD CODE End */ 
	$bg_color = $this->getWdBgcolor();
	if($this->getWdBgimage()){
		$bg_image_url = $poco_helper->getMediaUrl().$this->getWdBgimage();
		$bg_image = 'background-image: url('.$bg_image_url.'); background-repeat: no-repeat; background-size: cover;';
	}else{
		$bg_image = '';
	} 
	
	$spacing_class = '';
	$spacing_class .= $this->getWdSpacing()?' sections-spacing ':'';
	$spacing_class .= $this->getWdBottomSpacing() ? ' section-bottom-spacing ' : '';
	$rtl = $poco_helper->getThemeLayout('rtl',$poco_helper->getStoreId())? true:false; 
	$animation = $poco_helper->getThemeLayout('animation',$poco_helper->getStoreId())? true:false; 
	$animation_class = $animation?"wow animate__fadeIn":" ";
	$show_deal_title = $this->getWdShowDealTitle();
	$show_deal_timer = $this->getWdShowDealTimer();
	$show_banner = $this->getData('wd_show_banner')?$this->getData('wd_show_banner'):0;
	$deal_banner = $this->getData('wd_image_section')?$this->getData('wd_image_section'):null;
	$pubPath = $poco_helper->getPubAbsolutePath();
	if($deal_banner){
		$deal_banner_url = $poco_helper->getMediaUrl().$deal_banner;
		$deal_banner_path = $pubPath.'media/'.$deal_banner;
	}else{
		$deal_banner_url = '';
		$deal_banner_path = '';
	}

?>
<?php if(($bg_image)||($bg_color)): ?>
<style type="text/css">
	<?php echo '#mage-deal-slider-'.$random_number. " { ".$bg_image."; background-color: ".$bg_color."; } " ?>
</style>
<?php endif; ?>
<div id="<?php echo "mage-deal-slider-".$random_number; ?>" class="mage-products mage-deal-slider style2 <?php /* @escapeNotVerified */ echo $mode; ?> <?php echo $spacing_class ?>">
		<div class="container">
			<div class="d-flex alc">
				<div class="f-item tc <?php echo $animation_class ?>" <?php if($animation): ?> data-wow-delay="0.2s" <?php endif;?>">
				<?php if($deal_banner):?>
					<?php list($deal_banner_width, $deal_banner_height) = getimagesize($deal_banner_path);?>
						<div class="img_bnr"><img loading="lazy" src="<?php echo $deal_banner_url;?>" alt="<?php echo $title; ?>" title="<?php echo $title; ?>" width="<?php echo $deal_banner_width; ?>" height="<?php echo $deal_banner_height; ?>" /></div>
					<?php endif; ?>			
				</div>
				<div class="f-item dtls <?php echo $animation_class ?>" <?php if($animation): ?> data-wow-delay="0.4s" <?php endif;?>>
					<?php if($block->getDealData('description')): ?>
						<div class="deal_dtls"><?php echo $block->escapeHtml($deal_description); ?></div>
					<?php endif; ?>

					<?php if(($title)&&($show_deal_title)):?>
						<h2 class="ttl"><?php echo __(html_entity_decode($title)); ?></h2>
					<?php endif; ?>

					<?php if($show_deal_timer): ?>
						<?php echo $this->getLayout()->createBlock("Magento\Framework\View\Element\Template")->setData('count_time', $timer)->setTemplate("Magebees_TodayDealProducts::timer.phtml")->toHtml();?>
					<?php endif; ?>
					
					<?php if($block->getWdShowViewall()): $view_all_text = $block->getWdViewallTxt()?$block->getWdViewallTxt():'View All Collection'; $deal_url = $block->getWdViewallUrl(); ?>
							<a href="<?php echo $this->getUrl($deal_url, ['_secure' => true]);?>" title="<?php echo __(html_entity_decode($block->escapeHtml($view_all_text))); ?> " class="action primary">
								<svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="st-icon"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
								<?php echo __(html_entity_decode($block->escapeHtml($view_all_text))); ?>
							</a>
					<?php endif; ?>
				</div>
			</div>
		</div>
    </div>
<?php 
}
?>